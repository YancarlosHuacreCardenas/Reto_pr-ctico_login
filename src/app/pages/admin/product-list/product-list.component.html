<div class="lista-container">

  <div class="lista-header">
    <div>
      <h2>Gestión de Productos</h2>
      <p class="header-subtitle">Administra tu catálogo de productos</p>
    </div>
    <a routerLink="/admin/producto-form" class="btn btn-primary">+ Nuevo Producto</a>
  </div>

  <!-- Barra de búsqueda y filtros -->
  <div class="filter-bar">
    <div class="search-wrapper">
      <input
        type="text"
        placeholder="Buscar por nombre o descripción..."
        [(ngModel)]="searchText"
        (input)="applyFilters()"
        class="search-input"
      />
    </div>

    <div class="filters-right">
      <select [(ngModel)]="statusFilter" (change)="applyFilters()" class="filter-select">
        <option value="all">Todos (estado)</option>
        <option value="active">Activos</option>
        <option value="inactive">Inactivos</option>
      </select>

      <select [(ngModel)]="featuredFilter" (change)="applyFilters()" class="filter-select">
        <option value="all">Todos (destacado)</option>
        <option value="featured">Sí</option>
        <option value="not_featured">No</option>
      </select>
    </div>
  </div>

  <div *ngIf="error" class="error-message">{{ error }}</div>
  <div *ngIf="loading" class="loading">Cargando productos...</div>

  <div class="table-wrapper" *ngIf="!loading && filteredProducts.length > 0">
    <table class="table">
      <thead>
        <tr>
          <th class="col-id">ID</th>
          <th class="col-nombre">Nombre</th>
          <th class="col-desc">Descripción</th>
          <th class="col-cat">Categoría</th>
          <th class="col-precio">Precio</th>
          <th class="col-disponible">Disponible</th>
          <th class="col-destacado">Destacado</th>
          <th class="col-prep">Prep Time</th>
          <th class="col-imagen">Imagen</th>
          <th class="col-acciones">Acciones</th>
        </tr>
      </thead>

      <tbody>
        <tr *ngFor="let product of paginatedProducts" class="table-row">
          <td class="col-id">{{ product.product_id }}</td>
          <td class="col-nombre">{{ product.name }}</td>
          <td class="col-desc">{{ product.description || '-' }}</td>
          <td class="col-cat">{{ getCategoryLabel(product.category) }}</td>
          <td class="col-precio">${{ product.price.toFixed(2) }}</td>

          <td class="col-disponible">
            <span [class.available]="product.is_available"
                  [class.unavailable]="!product.is_available">
              {{ product.is_available ? "Sí" : "No" }}
            </span>
          </td>

          <td class="col-destacado">
            <span [class.featured]="product.is_featured"
                  [class.not-featured]="!product.is_featured">
              {{ product.is_featured ? "Sí" : "No" }}
            </span>
          </td>

          <td class="col-prep">{{ product.prep_time || "-" }}</td>

          <td class="col-imagen">
            <img *ngIf="product.image_url" [src]="product.image_url"
                 alt="Imagen de {{ product.name }}" class="product-image" />
            <span *ngIf="!product.image_url" class="no-image">-</span>
          </td>

          <td class="col-acciones">
            <div class="action-buttons">
              <a [routerLink]="['/admin/producto-form', product.product_id]" class="btn-edit">
                Editar
              </a>

              <button *ngIf="product.is_available"
                      (click)="deleteProduct(product.product_id)"
                      class="btn-delete">
                Eliminar
              </button>

              <button *ngIf="!product.is_available"
                      (click)="restoreProduct(product.product_id)"
                      class="btn-restore">
                Restaurar
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div *ngIf="!loading && filteredProducts.length === 0" class="empty-state">
    <p>No se encontraron productos</p>
  </div>

  <!-- PAGINACIÓN -->
  <div class="pagination" *ngIf="filteredProducts.length > 0">
    <button class="btn" (click)="prevPage()" [disabled]="currentPage === 1">
      ⬅ Anterior
    </button>

    <span class="page-info">Página {{ currentPage }} de {{ totalPages }}</span>

    <button class="btn" (click)="nextPage()" [disabled]="currentPage === totalPages">
      Siguiente ➡
    </button>
  </div>

</div>